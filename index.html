<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        #canvas{
            display: block;
        }
        /* 让canvas和视口同一边开始，减少差距 */
        body {
            margin: 0;
        }
        .actions {
            position: fixed;
            bottom:0;
        }
        .actions button {
            display:inline-block;
        }
    </style>
</head>
<body>
    <canvas id="canvas" width=300 height=300>

    </canvas>
    <div class="actions">
        <button id="eraser">橡皮檫</button>
        <button >画笔</button>
    </div>
    <script>
        var canvas = document.getElementById("canvas")
        autoSetCanvas(canvas) // 自适应屏幕宽高
        var context = canvas.getContext('2d')
        var penColor = 'red'
        var eraserEnabled = false // 橡皮檫使用情况
        var using = false
        var lastPoint = {x:undefined,y:undefined}

        // 橡皮檫控制
        eraser.onclick = function() {
            eraserEnabled = !eraserEnabled
        }

        canvas.onmousedown = function(event){
            var x = event.clientX
            var y = event.clientY
            using = true
            // 使用橡皮檫
            if(eraserEnabled) {
                // 使中心在鼠标中间（浏览器的坐标系）
                context.clearRect(x-5,y-5,10,10)
            } else {
                lastPoint = {x,y}
            }
        }
        canvas.onmousemove = function(event){
            var x = event.clientX
            var y = event.clientY
            if(using) {
                if(eraserEnabled ){
                    context.clearRect(x-5,y-5,10,10)
                } else {
                    var newPoint = {x,y}
                    drawCircle(x,y,1)   
                    drawLine(lastPoint.x,lastPoint.y,newPoint.x,newPoint.y)
                    lastPoint = newPoint
                }
            }
        }
        // 鼠标抬起，轨迹失效
        canvas.onmouseup = function(event){
            using = false
        }
        function drawCircle(x,y,radius){
            context.beginPath()
            context.fillStyle = penColor
            context.arc(x,y,radius,0,Math.PI*2)
            context.fill()
        }
        function drawLine(x1,y1,x2,y2){
            context.beginPath()
            context.moveTo(x1,y1) // 起点
            context.lineWidth = 5
            context.strokeStyle = penColor
            context.lineTo(x2,y2) // 终点
            context.stroke()
            context.closePath()
        } 

        function autoSetCanvas(canvas) {
            function canvasFillScreen() {
                // 获取屏幕的宽,高
                var pageWidth = document.documentElement.clientWidth
                var pageHeight = document.documentElement.clientHeight
                canvas.width = pageWidth
                canvas.height = pageHeight
            }
            canvasFillScreen()
            // 屏幕适配
            window.onresize = function(){
                canvasFillScreen()
            }
        }
    </script>
</body>
</html>